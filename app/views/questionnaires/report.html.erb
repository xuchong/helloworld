<% provide(:title, '分析图表') %>
<h1><h1>分析图表</h1></h1>
<script type="text/javascript">
$(function () {
   var choices= $('.lll');
for (var i = 0;i<choices.length ; i ++) {
var dad=new Array();
var dat=$('.sub'+choices[i].value.split(";")[0]);
for(var j=0;j<dat.length;j++)
{
  dad[j]=new Array();
  dad[j][0]=j.toString();
  dad[j][1]=parseFloat(dat[j].innerHTML);
}
    $('#container_pie'+choices[i].value.split(";")[0]).highcharts({
        chart: {
            height: 200,
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false
        },
        colors: ['#0293B2','#009369','#01A439','#68B92E','#F6B801','#E35F14','#DA251C','#DC1F55','#DD127B','#801D77'],
        title: {
            text: 'Browser market shares at a specific website, 2014'
        },
        tooltip: {
          pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                    style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                    }
                }
            }
        },
        series: [{
            type: 'pie',
            name: 'Browser share',
            data: dad
        }]
    });
   };
});
</script>

<script type="text/javascript">


$(function () {
  var choices = $('.lll');
  for (var i = 0; i < choices.length; i++) {
    var dad1 = new Array();
    var dad2=new Array();
    var dat = $('.sub' + choices[i].value.split(";")[0]);
    for (var j = 0; j < dat.length; j++) {
      dad1[j] = j.toString();
      dad2[j]= parseFloat(dat[j].innerHTML);
    }
    $('#container_bar' + choices[i].value.split(";")[0]).highcharts({
            chart: {
                height: 200,
                type: 'bar'

            },
            colors: ['#0293B2','#009369','#01A439','#68B92E','#F6B801','#E35F14'],
            title: {
                text: 'Historic World Population by Region'
            },
            subtitle: {
                text: 'Source: Wikipedia.org'
            },
            xAxis: {
                categories: dad1,
                title: {
                    text: null
                }
            },
            yAxis: {
                min: 0,
                title: {
                    text: 'Population (millions)',
                    align: 'high'
                },
                labels: {
                    overflow: 'justify'
                }
            },
            tooltip: {
                valueSuffix: ' millions'
            },
            plotOptions: {
                bar: {
                    dataLabels: {
                        enabled: true
                    }
                }
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'top',
                x: -40,
                y: 100,
                floating: true,
                borderWidth: 1,
                backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor || '#FFFFFF'),
                shadow: true
            },
            credits: {
                enabled: false
            },
            series: [{
                name: '答题数',
                data: dad2
            }]
        });
    }
    });
  </script>
<!--http://bolan392.iteye.com/blog/764163   一个用ajax传值的例子-->

<!--问卷分析页面设计-->
<br><br><br><br><br><br>
<div>
<h3><%=  @questionnaire.qa_title %></h3>
</div>

<% @questions.each do |question| %>
<div class="question_head_container">
  <h2 class="question_head"><%= question.q_content %></h2>
</div>
<!--动态生成id-->
<% if question.q_type == 1||question.q_type==3||question.q_type==2 %>
<div id= "chart_container"> 
  <%if question.q_type == 1||question.q_type==3%>
<div id="container_pie<%=question.id%>" style="min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto"></div>
<%end%>
  <%if question.q_type == 2%>
<div id="container_bar<%=question.id%>" style="min-width: 310px; max-width: 800px; height: 400px; margin: 0 auto"></div> 
<%end%>
<input type="hidden" class="lll" value="<%=question.id%>;<%=question.q_type%>">
</div>
<% if question.q_type == 1||question.q_type==2%>
<% @choices = question.q_choice.split(";") %>
<%end%>
<% if question.q_type == 3%>
<% @choices =["True","False"] %>
<%end%>
<div id="option_container">
   <table class="table table-striped table-hover table-bordered">
        <thead>
                <tr>
                  <th width="50">#</th>
                  
                  <th>答案选项</th>
                  <th width="100"> 回复情况</th>
                </tr>
              </thead>
              <tbody>
               <% @choices.each_with_index do |onechoice,index| %> 
                <tr>
                  <td><%=index+1%></td>
                  <td><%=onechoice%></td>
                  <td class="sub<%=question.id%>"><%=@datahash[question.id][index]%></td>
                </tr>
               <%end%>
              </tbody>
    </table>
</div>
<%end%>
<%if question.q_type==4%>
<div>  
        <table class="table table-striped table-hover table-bordered">
                  <thead>
                  <tr>
                    <th>答案</th>
                  </tr>
                  </thead>  
                  <tbody>
                    <%@answers=question.answers%>
                    <%@answers.each do |answer|%>
                    <tr>
                    <td>
                      <%=answer.answer_content%>
                    </td>
                  </tr>
                    <%end%>
                  </tbody>
        </table>
</div>
<%end%>
<%end%>